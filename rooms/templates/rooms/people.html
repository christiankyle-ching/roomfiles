{% extends 'rooms/base.html' %}
{% load static %}

{% block content %}
<div class="container pt-4">

    <div class="d-block">
        
        <a class="btn btn-secondary btn-sm" 
        {% if ban_status %}href="{% url 'room-people' room.pk room.slug %}"{% else %}
        href="{% url 'room' room.pk room.slug %}"
        {% endif %}
        >
            <span class="material-icons">arrow_back</span>
        </a>

        {% if room.created_by == user and not ban_status %}
            <a href="{% url 'room-banned-people' room.pk room.slug %}"
            class="btn btn-secondary btn-raised btn-sm float-right">
                View Banned Users...
            </a>
        {% endif %}

    </div>


    
    {% if people %}
    
        <p class="text-muted pt-3 m-0 text-center">{{ people | length }} {% if ban_status %}<span class="text-danger"> banned </span>{% endif %}people in <strong>{{ room.name }}</strong></p>

        <ul class="list-group">
            <form method="POST" id="banForm">
            {% csrf_token %}
                {% for person in people %}
                <li class="list-group-item">
                    
                    <div class="w-100">
                    
                        <div class="float-left m-0">
                            {% include 'rooms/item_templates/avatar_thumbnail.html' %}
                        </div>

                        <div class="py-1 d-flex justify-content-between">

                            <div class="text-truncated">
                                
                                <h6 class="{% if user.profile == person %}text-primary{% endif %}">
                                    {{ person.user.profile.display_username }}
                                    
                                    {% if room.created_by == person.user %} (Creator) {% endif %}
                                </h6>
                                
                                <span {%if person.user.profile.display_name == 'Unnamed' %}class="text-muted"{% endif %}>
                                    {{ person.user.profile.display_name }}
                                </span>
                            </div>

                            <!-- Ban Button -->
                            {% if not person.user == user and user == room.created_by %}
                            

                            <button type="button" class="btn {% if ban_status %}btn-primary{% else %}btn-danger{% endif %} btn-sm float-right d-flex"
                            data-toggle="modal" data-target="#banModal" data-ban-status="{{ ban_status }}"
                            data-user-id="{{person.user.id}}" data-username="{{person.user.username}}">

                                {% if ban_status %}
                                <span class="material-icons m-0">add_circle</span>
                                {% else %}
                                <span class="material-icons m-0">remove_circle</span>
                                {% endif %}
                                
                            </button>

                            {% endif %}

                        </div>
                    
                    </div>

                </li>
                {% endfor %}

                <!-- Ban Modal -->
                <div id="banModal" class="modal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title">
                              {% if ban_status %}Unban{% else %}Ban{% endif %} user in your room?
                          </h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <p></p>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                          <button type="submit"
                          class="btn {% if ban_status %}btn-primary{% else %}btn-danger{% endif %}" name="user_id">
                              {% if ban_status %}
                                Yes, remove ban
                              {% else %}
                                Yes, ban user
                              {% endif %}
                          </button>
                        </div>
                      </div>
                    </div>
                </div>
            </form>
        </ul>

    
    {% else %}
        <div class="text-center">
            {% if not ban_status %}
                <span>No people in this room yet. Invite your mates!
            {% else %}
                <span>No banned people in the room.
            {% endif %}
        </div>
    {% endif %}

</div>

{% endblock %}