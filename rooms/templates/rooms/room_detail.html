{% extends 'rooms/base.html' %}
{% load static %}

{% block content %}
<div class="container" id="roomDetailID">

    <div class="card my-3">

        <div class="card-body">

            <div>
                <h4 class="float-left">{{ room.name }}</h4>

                <!-- Room Menu Options -->
                <div class="dropdown float-right">
                    <button class="btn btn-dark" type="button" id="optionsMenuButton" data-toggle="dropdown">
                      <svg width="1.5em" height="1.5em">
                        <use width="1.5em" height="1.5em" xlink:href="{% static 'icons/menu-dots.svg' %}#fill" >
                      </svg>
                    </button>
          
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="optionsMenuButton">
                        
                        <a href="{% url 'file-upload' %}" class="dropdown-item">Upload a File</a>

                        {% if room.created_by == user %}
                        <a href="{% url 'room-edit' room.pk room.slug %}" class="dropdown-item">Edit</a>
                        {% endif %}

                        <a href="{% url 'room-leave' %}" class="dropdown-item text-danger">Leave Room</a>
                    </div>
                </div>
            </div>
            
            <div class="row w-100 no-gutters">

                <div class="col">
                    <h6>
                        Code: <code id="roomCode" data-hide="false">{{ room.id }}</code>
                    </h6>
                </div>
                <div class="col-auto">
                    <button id="roomCodeCopy" class="btn btn-sm btn-dark float-right" data-toggle="snackbar" data-style="toast" data-content="Copied the room code.">
                        <svg width="16" height="16">
                            <use width="16" height="16" xlink:href="{% static 'icons/copy.svg' %}#fill" >
                        </svg>
                    </button>
                    <button id="roomCodeToggle" class="btn btn-sm btn-dark float-right">
                        <svg width="16" height="16">
                            <use width="16" height="16" xlink:href="{% static 'icons/show.svg' %}#fill" >
                        </svg>
                    </button>
                </div>
                
            </div>
            
            <p class="pt-3">
                <span class="text-muted">Description</span><br>
                {{ room.description }}
            </p>

        
            <ul class="nav nav-tabs nav-justified" id="roomTabs" role="tablist">
                <li class="nav-item">
                    <a href="#files" class="nav-link active" id="files-tab" data-toggle="tab">Files</a>
                </li>
                <li class="nav-item">
                    <a href="#people" class="nav-link" id="files-tab" data-toggle="tab">People</a>
                </li>
            </ul>

            <div class="tab-content" id="roomTabsContent">

                <!-- Files -->
                <div class="tab-pane fade show active" id="files" role="tabpanel">
                    <div class="container pt-3">
                        {% if files %}
                            <p class="text-muted">{{ files | length }} files</p>

                            {% for file in files %}
                            <div id="{{ file.pk }}" class="row">
                                <div class="col">
                                    <h6> <a href="{% url 'file' file.pk %}">{{ file.name }}</a></h6>
                                
                                    <p>
                                        By: {{ file.uploaded_by.username }}
                                        {% if file.uploaded_by.last_name %}
                                            ({{file.uploaded_by.last_name}})
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="col-auto text-right">

                                    <!-- File Options : Buttons -->
                                    <div class="d-none d-sm-block">
                                        {% if file.uploaded_by == user %}
                                        <a href="{% url 'file-delete' file.pk %}" class="btn btn-danger">
                                            <svg width="16" height="16">
                                                <use xlink:href="{% static 'icons/delete.svg' %}#fill" >
                                            </svg>
                                        </a>
                                        <a href="{% url 'file-edit' file.pk %}" class="btn btn-dark">
                                            <svg width="16" height="16">
                                                <use xlink:href="{% static 'icons/edit.svg' %}#fill" >
                                            </svg>
                                        </a>
                                        {% endif %}
                                        <a href="{% url 'file' file.pk %}" class="btn btn-primary">
                                            <svg width="16" height="16">
                                                <use xlink:href="{% static 'icons/download.svg' %}#fill" >
                                            </svg>
                                        </a>
                                    </div>

                                    <!-- File Options : Menu -->
                                    <div class="d-sm-none">
                                        <div class="dropdown">
                                            <button class="btn btn-dark" type="button" id="fileOptionsMenuButton" data-toggle="dropdown">
                                                <svg width="16" height="16">
                                                  <use width="16" height="16" xlink:href="{% static 'icons/menu-dots.svg' %}#fill" >
                                                </svg>
                                              </button>

                                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="fileOptionsMenuButton">
                                                <a href="{% url 'file' file.pk %}" class="dropdown-item text-primary">Download</a>
                                                {% if file.uploaded_by == user %}
                                                <a href="{% url 'file-edit' file.pk %}" class="dropdown-item">Edit</a>
                                                <a href="{% url 'file-delete' file.pk %}" class="dropdown-item text-danger">Delete</a>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                    </div>

                                    
                                </div>

                            </div>
                            {% endfor %}
            
                        
            
                        {% else %}
                        <div class="text-center">
                            <span>No files in this room yet. <a href="{% url 'file-upload' %}">Upload one.</a></span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- People -->
                <div class="tab-pane fade" id="people" role="tabpanel">
                    <div class="container pt-3">
                        {% if people %}
                            <p class="text-muted">{{ people | length }} people</p>
                
                            {% for person in people %}
                            <div>
                                {% if user.profile == person %}
                                <h6 class="text-primary">{{ person.user.username }} (You)</h6>
                                {% else%}
                                <h6>{{ person.user.username }}</h6>
                                {% endif %}

                                
                                <p class="text-muted">
                                    {% if person.first_name == "" and person.last_name == "" %}
                                        Unnamed
                                    {% else %}
                                        {{ person.last_name }}, {{ person.first_name }}
                                    {% endif %}
                                </p>

                            </div>
                            {% endfor %}
                
                        {% else %}
                            <div class="text-center">
                                <span>No people in this room yet. Invite your mates!
                            </div>
                        {% endif %}
                    </div>
                </div>

            </div>

        </div>
        <!-- End Card Body -->

    </div>
    <!-- End Card -->

</div>
{% endblock %}